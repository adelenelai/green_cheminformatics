---
title:  "DataViz for High-dimensional Environmental Data  #1"
---
# Some preliminary thoughts & a Hack to get Top-10 Boxplots using `ggplot`<br/>



I've always been a bit of a [dataviz nerd](https://www.cbs.nl/en-gb/corporate/2018/23/visualising-inequality-at-the-sdg-dataviz-camp) (that's me in the middle), but mostly in my spare time. 


These days, I'm lucky to work with plenty of interesting environmental chemistry datasets in my PhD, and I thought I'd share some lessons learned in this blog.


In general, my approach to dataviz is *one-size does **not** fit all* - it really depends on what you are trying to achieve.


Typically in a scientific context, I think a data visualisation should support or demonstrate whatever claim you are making. Sometimes, dataviz can also be used to identify knowledge gaps and generate further research questions (more on that later).


But for now, before getting too philosophical, let's consider what I think is one hallmark of many environmental chemistry datasets: *they will most likely have many features*, a.k.a. dimensions*. A feature or a dimension is basically something you can put on the axis of a plot.


In fact, it's fairly common these days to find papers studying environmental chemical pollutants as part of regional or even national sampling campaigns, which means at minimum, you'll have 3-4 dimensions to deal with: `compound`, `concentration`,  `location`, and `time`. 


(And with the growing number and quality of [open source workflows](https://jcheminf.biomedcentral.com/articles/10.1186/s13321-020-00477-w), it's only becoming 'easier' to process huge amounts of data - bring on more dimensions!)


Inevitably, the question arises...


### What's a good way to visualise these high-dimensional environmental data?<br/>



Here's an example. 


Let's say I'm working on a fairly large dataset consisting of:

 * ~100 chemical compounds measured at 
 * \> 10 geographical sampling locations 
 * \>10 sampling timepoints	
 * and their respective concentration values at each location and timepoint.
 
 
In practice, the data look something like this:


<embed gist>
 
 
As a *first step*, I want to gain a *broad overview of the range of concentration values* measured for *each compound across all sampling locations and timepoints*. 


One relatively simple way of visualising ranges is to plot the concentrations as **boxplots**, one for each compound. Here for example, I've plotted them in ascending order of Median log(Concentration). 

<embed gist>


While it gives a decent overview of the concentration ranges across all compounds, it is definitely too busy. 


Is there a good way to plot e.g. the Top 10 boxplots? (i.e. Compounds whose median logConcentrations are the Top 10)


To achieve this, typically most people would just sort their median concentrations in descending order, subset the first 10 rows of their `data.frame`, and plot these (in this case, 20 because the data are separated according to `time` and here there are 2 years).


However, I can't do that - here you'll notice in the `aes` argument of `ggplot` that I calculated and ordered the median values "in situ" .Basically, I calculated them within the plotting function instead of pre-calculating them before plotting.


I could have of course pre-calculated these median values and stored them in a new column within the same `data.frame`. However, in my particular case, I planned to generate multiple views (versions) of the data by calculating multiple median concentration values across e.g. sampling location, sampling timepoint, selected locations/timepoints respectively, which would mean more and more columns in my already large `data.frame`.


So to avoid bloating my `data.frame` (or generating more `data.frame`s for that matter), I thought calculating the median values within the `ggplot` call was the most elegant solution. The downside now of course, is that doing so doesn't allow me to subset my data if I just want to plot the Top-10.


*Hmmmm...*


(Naturally, all the intense googling of "ggplot display top 10 boxplots", "subset ggplot boxplots", and variations thereof yielded nothing.)


Then it occurred to me as I was looking at the plot, that I should just subset the dataset by the Compound names running on the x-axis: *find the names of the first 10 compounds going from right to left and just plot these!*


One can of course do this manually when working with just 10, but like most programmers I'm pretty lazy. (Also, what if we eventually want to plot the top 100? top 200? Not to mention how error-prone humans are.)


So, since #GIYBF, I searched something like "ggplot extract axis tick labels", as I suspected that somewhere in all the invisible and internal plotting magic, there had to be some intermediate dataset between what I input as the `data` argument of `ggplot`, and what actually shows up in the plot object..


 [*Hey presto!*](https://stackoverflow.com/questions/31223818/accessing-vector-of-axis-ticks-for-an-existing-plot-in-ggplot2) Behold `ggplot_build()`. (#SOIYBF)

<gist>


Is this the best way to do it?


Some last thoughts and caveats:







(for now, let's limit ourselves to static plots on a piece of paper, no fancy interactive animations)



Do boxplots make sense? IQ Ranges and outliers concept make sense...assumes a normal distribution?






